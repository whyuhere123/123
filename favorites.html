<!DOCTYPE html>
<html lang="ru" data-theme="gray">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Избранное — TROYKA SHOP</title>
    <link rel="stylesheet" href="styles.css">
    <script defer src="script.js"></script>
</head>
<body>
    <header class="site-header">
        <div class="container navbar nav-wrap">
            <a href="index.html" class="display-title" style="text-decoration:none; font-size: clamp(20px,4.5vw,28px);">
                <span class="gradient-text">TROYKA</span> <span class="accent">SHOP</span>
            </a>
            <nav class="nav">
                <a class="nav-link" href="index.html">Категории</a>
                <a class="nav-link" href="cart.html">Корзина</a>
                <a class="nav-link active" href="favorites.html">Избранное</a>
                <a class="nav-link" href="profile.html">Профиль</a>
            </nav>
        </div>
    </header>
    <main class="container" style="padding-bottom:64px;">
        <h2 style="margin-bottom: 16px;">Избранное</h2>
        <div id="favoritesGrid" class="grid" style="grid-template-columns: repeat(2, minmax(0,1fr));"></div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const state = JSON.parse(localStorage.getItem('mini_shop_state_v1')||'{}');
            const favorites = state.favorites || [];
            const grid = document.getElementById('favoritesGrid');
            
            if (favorites.length === 0) {
                grid.innerHTML = '<div class="empty">В избранном пока ничего нет</div>';
                return;
            }
            
            grid.innerHTML = '';
            favorites.forEach(productId => {
                const p = (state.products||[]).find(x => x.id === productId);
                if (!p) return;
                
                const card = document.createElement('div');
                card.className = 'product-card';
                const cat = (state.categories||[]).find(c => c.id === p.categoryId);
                const slug = cat && cat.slugEn ? cat.slugEn : '';
                card.innerHTML = `
                    <a class="link-card" href="product.html?cat=${encodeURIComponent(slug)}&sku=${encodeURIComponent(p.sku || '')}">
                        <img class="thumb" src="${p.image}" alt="${p.name}">
                    </a>
                    <div class="body">
                        <div class="title">${p.name}</div>
                        <div class="muted" style="font-size: 12px;">нет отзывов</div>
                        <div class="actions">
                            <div style="display: flex; gap: 6px;">
                                <button class="btn-icon favorite-btn active" data-id="${p.id}" title="Убрать из избранного">
                                    <svg viewBox="0 0 24 24"><path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5C22 12.27 18.6 15.36 13.45 20.03L12 21.35Z"/></svg>
                                </button>
                            </div>
                            <div class="price">${p.price.toLocaleString('ru-RU')} ₽</div>
                        </div>
                    </div>
                `;
                
                // избранное
                card.querySelector('.favorite-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    const ev = new CustomEvent('toggle-favorite', { detail: { productId: p.id } });
                    window.dispatchEvent(ev);
                    card.remove();
                });
                
                grid.appendChild(card);
            });
        });
    </script>
</body>
</html>
